USE [adaptiva_stephini_patch_data]
GO

/****** Object:  UserDefinedFunction [dbo].[fnt_int_binary_list2]    Script Date: 2/12/2024 10:58:44 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [dbo].[fnt_int_binary_list2] (@binaryValue varbinary(max))
RETURNS @IDs TABLE (
	  int_value int NOT NULL  -- this is the only field that should matter
	, binary_value varbinary(8)
	, startSpot int
	, endSpot int
	, ord int identity(1,1) PRIMARY KEY
)
AS
BEGIN
	DECLARE
		  @binaryLength int = LEN(@binaryValue)
		, @thisValue varbinary(8)
		, @thisValue_int int
		, @startSpot int = 1
		, @endSpot int  
		, @int_length int = 4

	-- integers are 4 bytes, 8 hex characters
	-- start from the right of the binary and work left 8 bytes at a time.
	-- the last number in the array might not be a full 16 char hex.
	-- Thus the varbinary(8) column instead of a binary(8).
	-- return distinct non-NULL values only

	-- example call:
	-- SELECT * FROM [dbo].[fnt_int_binary_list](0xACED0005757200025B4A782004B512B175930200007870000000010000000000003105)

	WHILE @startSpot + @int_length <= @binaryLength 
	BEGIN
		SELECT
			  @thisValue = SUBSTRING(@binaryValue, @startSpot, @int_length)
			, @thisValue_int = TRY_CAST(@thisValue as varbinary(4))
			, @endSpot = @startSpot + @int_length

		INSERT @IDs (int_value, binary_value, startSpot, endSpot)
		SELECT @thisValue_int, @thisValue, @startSpot, @endSpot

		SELECT @startSpot += 1
	END

	RETURN
END
GO




DECLARE @bval varbinary(max) = 
0xACED000573720042636F6D2E61646170746976612E7061746368696E672E6465706C6F792E7365727665722E696E74656E742E617070726F76616C2E5061746368417070726F76616C738BFE5C4194D9590B0200035A000A6E6F726D616C697A65644C0009617070726F76616C737400104C6A6176612F7574696C2F4C6973743B4C001E64656475706C696361746564427573696E657373556E697441727261797371007E0001787001737200136A6176612E7574696C2E41727261794C6973747881D21D99C7619D03000149000473697A657870000000017704000000017372005D636F6D2E61646170746976612E7061746368696E672E6465706C6F792E7365727665722E696E74656E742E617070726F76616C2E5061746368417070726F76616C7324436F6D7061637453696E676C655061746368417070726F76616CD658E7357D5925690200074A000C617070726F76616C54696D65490011627573696E657373556E6974496E6465784A00116465706C6F796D656E744368616E6E656C42000C646573697265645374617465490007706174636849644A000F7061746368696E6750726F63657373420007757267656E637978700000018D88F21728000000000000000000000000023BB96A600000000000000AD801787371007E000300000001770400000001757200025B4A782004B512B1759302000078700000000100000000000220F378



SELECT x.*, co.JAVACLASSNAME 
FROM [dbo].[fnt_int_binary_list2](@bval) as x
INNER JOIN dbo.CLIENTOBJECTS as co
	ON x.int_value = co.OBJECTID	
WHERE x.int_value > 1
ORDER BY x.ord



